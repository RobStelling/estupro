!function(){var t={version:"1.0.5"};t.histograma=function(){function e(){var e=d3.select(".y.axis");e.on("mouseover",function(){var e=d3.select("div.myTip");return e.html(t.legenda+" - "+s),cl.tooltip.style("visibility","visible")}).on("mousemove",function(){return cl.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+15+"px")}).on("mouseout",function(){return cl.tooltip.style("visibility","hidden")})}function n(){svgH.selectAll(".bar").on("mouseover",function(e){var n=d3.select("div.myTip");return"aisp"==u?n.html("RISP "+cl.aisp("risp",e[0])+"<br>"+cl.aisp("nome",e[0])+": "+e[1].toLocaleString()):n.html("RISP "+cl.aisp("risp",cl.nomeDP[e[0]].aisp)+"<br>"+cl.aisp("nome",cl.nomeDP[e[0]].aisp)+"<br>"+cl.dp(e[0])+": "+e[1].toLocaleString()+"<br>"+cl.nomeDP[e[0]].up),d3.select("svg #H"+e[0]).style("fill",function(e){return P=this.style.fill,t.SELECIONADO}),d3.selectAll(".cisp").filter(function(t){switch(cl.status){case"aisps":case"risps":return"aisp"==hist.tipo()?e[0]==t.properties.AISP:e[0]==t.properties.DP;case"cisps":return"aisp"==hist.tipo()?!1:e[0]==t.properties.DP;case"aisp":return e[0]==t.properties.AISP;case"cisp":return e[0]==t.properties.DP}}).style("fill",cl.SELECIONADO),cl.tooltip.style("visibility","visible")}).on("mousemove",function(){return cl.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+15+"px")}).on("mouseout",function(t){return this.style.fill=P,d3.selectAll(".cisp").filter(function(t){return this.style.fill==cl.SELECIONADO}).style("fill",P),cl.tooltip.style("visibility","hidden")})}function r(){var e=hsx.domain(x.sort(this.checked?function(t,e){return e[1]-t[1]}:function(e,n){return d3.ascending(t.nomeAISPouDP[u](e[0]),t.nomeAISPouDP[u](n[0]))}).map(function(e){return t.nomeAISPouDP[u](e[0])})).copy();svgH.selectAll(".bar").sort(function(n,r){return e(t.nomeAISPouDP[u](n[0]))-e(t.nomeAISPouDP[u](r[0]))});var n=svgH.transition().duration(950),r=function(t,e){return 30*e};n.selectAll(".bar").delay(r).attr("x",function(n){return e(t.nomeAISPouDP[u](n[0]))}),n.select(".x.axis").call(hsxAxis).selectAll("g").delay(r).selectAll("text").attr("y",0).attr("x",y).attr("dy",".35em").attr("transform","rotate(-90)").style("text-anchor","end")}function a(e,n){var r,a,i=[];for(r=0,a=0;r<e.length;r++)void 0!=t.nomeAISPouDP[n](e[r][0])&&(i[a++]=e[r]);return k1=i.sort(function(e,r){return d3.ascending(t.nomeAISPouDP[n](e[0]),t.nomeAISPouDP[n](r[0]))}),k1}function i(){var i,p;d3.select("input#hist").property("checked",!1),o[s]=a(o[s],u),x=o[s],i="linear"==c?d3.scale.linear().range([g,0]):d3.scale.sqrt().range([g,0]),p=d3.svg.axis().scale(i).orient("left"),hsx.domain(o[s].map(function(e,n){return t.nomeAISPouDP[u](e[0])})),(dataMin=Math.min(0,d3.min(o[s],function(t,e){return t[1]})))<0&&("linear"==c?dataMin=1.05*dataMin:dataMin=1.3*dataMin),i.domain(d),hstext.remove(),v?(d3.select(".y.axis").transition().duration(1e3).call(p),d3.select(".y.axis").select("text.gLabel").text(t.legenda=l+" - "+s),hsx.domain(o[s].map(function(e,n){return t.nomeAISPouDP[u](e[0])})),d3.select(".x.axis").transition().duration(900).ease("linear").call(hsxAxis).style("opacity",1).selectAll("text").attr("y",0).attr("x",y).attr("dy",".35em").attr("transform","rotate(-90)").style("text-anchor","end"),setTimeout(function(){d3.select(".x.axis").call(hsxAxis).style("opacity",1).selectAll("text").attr("y",0).attr("x",y).attr("dy",".35em").style("font-size",(hsx.rangeBand()-5)/19*.7+.5+"em").attr("transform","rotate(-90)").style("text-anchor","end")},1100),cancelaLupa()):(svgH.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(hsxAxis).selectAll("text").attr("y",0).attr("x",y).attr("dy",".35em").attr("transform","rotate(-90)").style("font-size",(hsx.rangeBand()-5)/19*.7+.5+"em").style("text-anchor","end"),svgH.append("g").attr("class","y axis").call(p).append("text").attr("class","gLabel").attr("transform","rotate(-90)").attr("y",2).attr("dy",".71em").style("text-anchor","end").text(l+" - "+s)),h=!1;var m=d3.select(".myHist").selectAll(".bar").data(o[s],function(e){return t.nomeAISPouDP[u](e[0])});m.transition().duration(100).attr("x",function(e){return hsx(t.nomeAISPouDP[u](e[0]))}),m.transition().ease("sin-in-out").duration(1e3).attr("y",g).attr("height","0"),m.enter().append("rect").attr("class","bar").attr("width",hsx.rangeBand()).attr("y",g).attr("height","0").attr("id",function(t){return"H"+t[0]}),m.transition().duration(1e3).attr("y",function(t){return i(t[1])}).attr("x",function(e){return hsx(t.nomeAISPouDP[u](e[0]))}).attr("height",function(t){return g-i(t[1])}).attr("width",hsx.rangeBand()).style("fill",function(t){return cl.cor(t[1])}).style("fill-opacity",1),m.exit().transition().duration(100).attr("height","0").style("fill-opacity",1e-6).remove(),d3.select("input#hist").on("change",r),n(),t.legenda=l,e(),v||lupa(d3.select(".myHist"),20,555),v=!0}var s,o=[],l="Histograma",c="linear",u="",d=[],p="Eixo X",m={top:20,right:10,bottom:160,left:70},f=950-m.left-m.right,g=600-m.top-m.bottom,x=[];t.SELECIONADO="black";var h=!1,y=-20,v=!1;svgH=d3.select("body").select("div.hist").append("svg").attr("viewBox","0 0 "+(f+m.left+m.right)+" "+(g+m.top+m.bottom)).append("g").attr("class","myHist").attr("transform","translate("+m.left+","+m.top+")"),hstext=svgH.append("text").attr({"class":"titulo1",x:"0",dx:".20em",y:String((g+m.top+m.bottom)/2)}).text("Aguarde..."),hsx=d3.scale.ordinal().rangeRoundBands([0,f],.1,1),hsxAxis=d3.svg.axis().scale(hsx).orient("bottom");var P;return t.stringLimpa=function(t){return t.toUpperCase().replace(/ /g,"").replace(/[ÃÂÁÀÄ]/g,"A").replace(/[ÊÉÈË]/g,"E").replace(/[ÎÍÌÏ]/g,"I").replace(/[ÕÔÓÒÖ]/g,"O").replace(/[ÛÚÙÜ]/g,"U")},t.nomeAISPouDP={aisp:function(t){return cl.aisp("nome",t)},cisp:function(t){return void 0!=cl.nomeDP[t]?cl.nomeDP[t].up:"undefined"}},i.dados=function(t){return arguments.length?(o=t,i):o},i.legenda=function(t){return arguments.length?(l=t,i):l},i.escalaY=function(t){return arguments.length?(c=t,i):c},i.mensagemxAxis=function(t){return arguments.length?(p=t,i):p},i.tipo=function(t){return arguments.length?(u=t,i):u},i.clicou=function(t){return arguments.length?(h=t,i):h},i.ano=function(t){return arguments.length?(s=t,i):s},i.rangeHist=function(t){return arguments.length?(d=t,i):d},i},"function"==typeof define&&define.amd?(this.hs=t,define(t)):"object"==typeof module&&module.exports?module.exports=t:this.hs=t}();