function preencheIndicador(s){for(indicador=d3.select("#selecIndicador"),i=0;i<s.length;i++)s[i].selecionado?indicador.append("option").attr("value",String(i+1)).text(s[i].legenda1):indicador.append("option").attr("value",String(i+1)).text(s[i].legenda1).attr("disabled",!0);temIndicador="sim"}function selIndicador(){var s=document.getElementById("selecIndicador");(selInd=s.selectedIndex-1)>=0&&(cl.pintaMapa(vetDados[selInd].dados,vetDados[selInd].distribuicao,vetDados[selInd].tipo,vetDados[selInd].range,vetDados[selInd].legenda2,initClasse(vetDados[selInd].classes)),hist.dados(vetDados[selInd].dados).legenda(vetDados[selInd].legenda2).escalaY(vetDados[selInd].distribuicao).tipo(vetDados[selInd].tipo).call()),document.getElementById("selecIndicador").options[0].selected=!0}function redraw(){rangeUpdate(),d3.select("#valor-classes").text(classes=+classesInput.property("value")),("aisp"==cl.status||"cisp"==cl.status)&&(cl.pintaMapa(vetDados[selInd].dados,vetDados[selInd].distribuicao,vetDados[selInd].tipo,vetDados[selInd].range,vetDados[selInd].legenda2,classes),hist())}function rangeUpdate(){d3.select("#valor-classes").text(classes=+classesInput.property("value"))}function initClasse(s){return classesInput.property("value",s),d3.select("div#selecionaClasse").style("display","inline"),rangeUpdate(),s}function apagaRange(){d3.select("div#selecionaClasse").style("display","none")}function inicializaMapa(){"sim"==cl.leuJson&&"sim"==temIndicador&&(clearInterval(espera),selInd=0,cl.pintaMapa(vetDados[selInd].dados,vetDados[selInd].distribuicao,vetDados[selInd].tipo,vetDados[selInd].range,vetDados[selInd].legenda2,initClasse(vetDados[selInd].classes)),hist.dados(vetDados[selInd].dados).legenda(vetDados[selInd].legenda2).escalaY(vetDados[selInd].distribuicao).tipo(vetDados[selInd].tipo).call(),rangeUpdate())}var vetDados=[],temIndicador="não",dsv=d3.dsv(";","text/plain"),q=d3_queue.queue;cl.leJson(),dsv("./csv/mensagemISP.csv",function(s){cl.textoISP("RISP",s[0].RISP),cl.textoISP("AISP",s[0].AISP),cl.textoISP("CISP",s[0].CISP)}),q().defer(dsv,"./csv/Estupro2015.csv",function(s){return{aisp:+s.AISP,dp:+s.DP,NomeUP:s.UP,meses:[+s.JAN,+s.FEV,+s.MAR,+s.ABR,+s.MAI,+s.JUN,+s.JUL,+s.AGO,+s.SET,+s.OUT,+s.NOV,+s.DEZ],total:+s.TOTAL}}).defer(dsv,"./csv/Estupro2014.csv",function(s){return{aisp:+s.AISP,dp:+s.DP,NomeUP:s.UP,meses:[+s.JAN,+s.FEV,+s.MAR,+s.ABR,+s.MAI,+s.JUN,+s.JUL,+s.AGO,+s.SET,+s.OUT,+s.NOV,+s.DEZ],total:+s.TOTAL}}).defer(dsv,"./csv/Estupro2013.csv",function(s){return{aisp:+s.AISP,dp:+s.DP,NomeUP:s.UP,meses:[+s.JAN,+s.FEV,+s.MAR,+s.ABR,+s.MAI,+s.JUN,+s.JUL,+s.AGO,+s.SET,+s.OUT,+s.NOV,+s.DEZ],total:+s.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2015.csv",function(s){return{aisp:+s.AISP,dp:+s.DP,NomeUP:s.UP,meses:[+s.JAN,+s.FEV,+s.MAR,+s.ABR,+s.MAI,+s.JUN,+s.JUL,+s.AGO,+s.SET,+s.OUT,+s.NOV,+s.DEZ],total:+s.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2014.csv",function(s){return{aisp:+s.AISP,dp:+s.DP,NomeUP:s.UP,meses:[+s.JAN,+s.FEV,+s.MAR,+s.ABR,+s.MAI,+s.JUN,+s.JUL,+s.AGO,+s.SET,+s.OUT,+s.NOV,+s.DEZ],total:+s.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2013.csv",function(s){return{aisp:+s.AISP,dp:+s.DP,NomeUP:s.UP,meses:[+s.JAN,+s.FEV,+s.MAR,+s.ABR,+s.MAI,+s.JUN,+s.JUL,+s.AGO,+s.SET,+s.OUT,+s.NOV,+s.DEZ],total:+s.TOTAL}}).await(function(s,a,e,d,o,t,i){s&&console.log(s);var n,l,r=[],c=[],p={};for(dados=a,l=0;l<dados.length;l++)isNaN(dados[l].total)||(c.push([dados[l].dp,dados[l].total]),void 0==p[dados[l].aisp]?p[dados[l].aisp]=dados[l].total:p[dados[l].aisp]+=dados[l].total);n=0;for(var l in p)r.push([+l,p[l]]),n+=p[l];vetDados.push({selecionado:!0,dados:r,distribuicao:"linear",tipo:"aisp",range:["#ffffcc","#802626"],legenda1:"Estupros em 2015 por AISP",legenda2:"Estupros em 2015 p/AISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!0,dados:c,distribuicao:"linear",tipo:"cisp",range:["#ffffcc","#802626"],legenda1:"Estupros em 2015 por CISP",legenda2:"Estupros em 2015 p/CISP ("+n.toLocaleString()+")",classes:7});var g=[],u=[];for(dados=e,p={},l=0;l<dados.length;l++)isNaN(dados[l].total)||(u.push([dados[l].dp,dados[l].total]),void 0==p[dados[l].aisp]?p[dados[l].aisp]=dados[l].total:p[dados[l].aisp]+=dados[l].total);n=0;for(var l in p)g.push([+l,p[l]]),n+=p[l];vetDados.push({selecionado:!0,dados:g,distribuicao:"linear",tipo:"aisp",range:["#ffffcc","#802626"],legenda1:"Estupros em 2014 por AISP",legenda2:"Estupros em 2014 p/AISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!0,dados:u,distribuicao:"linear",tipo:"cisp",range:["#ffffcc","#802626"],legenda1:"Estupros em 2014 por CISP",legenda2:"Estupros em 2014 p/CISP ("+n.toLocaleString()+")",classes:7});var I=[],v=[];for(dados=d,p={},l=0;l<dados.length;l++)isNaN(dados[l].total)||(v.push([dados[l].dp,dados[l].total]),void 0==p[dados[l].aisp]?p[dados[l].aisp]=dados[l].total:p[dados[l].aisp]+=dados[l].total);n=0;for(l in p)I.push([+l,p[l]]),n+=p[l];vetDados.push({selecionado:!0,dados:I,distribuicao:"linear",tipo:"aisp",range:["#ffffcc","#802626"],legenda1:"Estupros 2013 em por AISP",legenda2:"Estupros em 2013 p/AISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!0,dados:v,distribuicao:"linear",tipo:"cisp",range:["#ffffcc","#802626"],legenda1:"Estupros 2013 em por CISP",legenda2:"Estupros em 2013 p/CISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!1,dados:"",distribuicao:"",tipo:"",range:[],legenda1:"────────────────────────────────────────",legenda2:"────────────────────────────────────────",classes:0});var S=[],f=[];for(dados=o,p={},l=0;l<dados.length;l++)isNaN(dados[l].total)||(f.push([dados[l].dp,dados[l].total]),void 0==p[dados[l].aisp]?p[dados[l].aisp]=dados[l].total:p[dados[l].aisp]+=dados[l].total);n=0;for(l in p)S.push([+l,p[l]]),n+=p[l];vetDados.push({selecionado:!0,dados:S,distribuicao:"linear",tipo:"aisp",range:["#80ee80","#ff2d26"],legenda1:"Registro de Ocorrências 2015 por AISP",legenda2:"Registro de Ocorrências 2015 p/AISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!0,dados:f,distribuicao:"linear",tipo:"cisp",range:["#80ee80","#ff2d26"],legenda1:"Registro de Ocorrências 2015 por CISP",legenda2:"Registro de Ocorrências 2015 p/CISP ("+n.toLocaleString()+")",classes:7});var P=[],A=[];for(dados=t,p={},l=0;l<dados.length;l++)isNaN(dados[l].total)||(A.push([dados[l].dp,dados[l].total]),void 0==p[dados[l].aisp]?p[dados[l].aisp]=dados[l].total:p[dados[l].aisp]+=dados[l].total);n=0;for(l in p)P.push([+l,p[l]]),n+=p[l];vetDados.push({selecionado:!0,dados:P,distribuicao:"linear",tipo:"aisp",range:["#80ee80","#ff2d26"],legenda1:"Registro de Ocorrências 2014 por AISP",legenda2:"Registro de Ocorrências 2014 p/AISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!0,dados:A,distribuicao:"linear",tipo:"cisp",range:["#80ee80","#ff2d26"],legenda1:"Registro de Ocorrências 2014 por CISP",legenda2:"Registro de Ocorrências 2014 p/CISP ("+n.toLocaleString()+")",classes:7});var D=[],O=[];for(dados=i,p={},l=0;l<dados.length;l++)isNaN(dados[l].total)||(O.push([dados[l].dp,dados[l].total]),void 0==p[dados[l].aisp]?p[dados[l].aisp]=dados[l].total:p[dados[l].aisp]+=dados[l].total);n=0;for(l in p)D.push([+l,p[l]]),n+=p[l];vetDados.push({selecionado:!0,dados:D,distribuicao:"linear",tipo:"aisp",range:["#80ee80","#ff2d26"],legenda1:"Registro de Ocorrências 2013 por AISP",legenda2:"Registro de Ocorrências 2013 p/AISP ("+n.toLocaleString()+")",classes:7}),vetDados.push({selecionado:!0,dados:O,distribuicao:"linear",tipo:"cisp",range:["#80ee80","#ff2d26"],legenda1:"Registro de Ocorrências 2013 por CISP",legenda2:"Registro de Ocorrências 2013 p/CISP ("+n.toLocaleString()+")",classes:7}),preencheIndicador(vetDados)});var TITULORIO="Dados de Seguranca do Rio de Janeiro",TODASAISPS="Áreas Integradas de Segurança Pública",TODASRISPS="Regiões Integradas de Segurança Pública",TODASCIRPS="Circunscrições Integradas de Segurança Pública",hist=hs.histograma(),selInd,classesInput=d3.select("#classe").on("input",redraw).on("change",redraw),classes,espera=setInterval(inicializaMapa,500);