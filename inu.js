function preencheIndicador(e){for(indicador=d3.select("#selecIndicador"),i=0;i<e.length;i++)e[i].selecionado?indicador.append("option").attr("value",String(i+1)).text(e[i].legenda1):indicador.append("option").attr("value",String(i+1)).text(e[i].legenda1).attr("disabled",!0);temIndicador="sim"}function selIndicador(){var e=document.getElementById("selecIndicador");(selInd=e.selectedIndex-1)>=0&&(rio.dados(vetDados[selInd].dados).distribuicao(vetDados[selInd].distribuicao).tipo(vetDados[selInd].tipo).rangeData(vetDados[selInd].range).tit(vetDados[selInd].legenda1).faixas(+d3.select("#valor-classes").text()).totMes(vetDados[selInd].total).call(),hist.dados(vetDados[selInd].dados).legenda(vetDados[selInd].legenda1).escalaY(vetDados[selInd].distribuicao).tipo(vetDados[selInd].tipo).rangeHist(vetDados[selInd].range).call()),document.getElementById("selecIndicador").options[0].selected=!0}function redraw(){rangeUpdate(),d3.select("#valor-classes").text(classes=+classesInput.property("value")),("aisp"==cl.status||"cisp"==cl.status)&&(rio.faixas(+d3.select("#valor-classes").text()).call(),hist())}function rangeUpdate(){d3.select("#valor-classes").text(classes=+classesInput.property("value"))}function initClasse(e){return classesInput.property("value",e),d3.select("div#selecionaClasse").style("display","inline"),rangeUpdate(),e}function apagaRange(){d3.select("div#selecionaClasse").style("display","none")}function inicializaMapa(){"sim"==cl.leuJson&&"sim"==temIndicador&&(clearInterval(espera),selInd=0,rio.dados(vetDados[selInd].dados).distribuicao(vetDados[selInd].distribuicao).tipo(vetDados[selInd].tipo).rangeData(vetDados[selInd].range).tit(vetDados[selInd].legenda1).faixas(initClasse(vetDados[selInd].classes)).ano(vetDados[selInd].ano).totMes(vetDados[selInd].total).call(),hist.dados(vetDados[selInd].dados).legenda(vetDados[selInd].legenda1).escalaY(vetDados[selInd].distribuicao).tipo(vetDados[selInd].tipo).ano(vetDados[selInd].ano).rangeHist(vetDados[selInd].range).call(),rangeUpdate())}var vetDados=[],temIndicador="não",dsv=d3.dsv(";","text/plain"),q=d3_queue.queue,lang;lang=window.navigator.userLanguage||"pt-BR"==window.navigator.language?0:1,lang&&(d3.select("#tituloPagina").html("Rape cases in Rio de Janeiro since 2013 to April 2016"),d3.select("#comentario").html("2016 numbers based on January/16 to April/16 average"),d3.select("#vejaTambem").html('See also: <a href="/impeachment" id="linkAlternativo">Brazil Impeachment Voting 2016</a>'),d3.select("#tabMapa").html("Map"),d3.select("#tabHistograma").html("Histogram"),d3.select("#selecaoIndicador").html("Select indicator..."),d3.select("#ordena").html(" Sort"),d3.select("#tituloClasses").html("Classes: "),d3.select("#textoClasses").html(" Classes")),cl.leJson(),dsv("./csv/mensagemISP.csv",function(e){lang?(cl.textoISP("RISP",e[0].RISP_en),cl.textoISP("AISP",e[0].AISP_en),cl.textoISP("CISP",e[0].CISP_en)):(cl.textoISP("RISP",e[0].RISP),cl.textoISP("AISP",e[0].AISP),cl.textoISP("CISP",e[0].CISP))}),q().defer(dsv,"./csv/Estupro2016.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/Estupro2015.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/Estupro2014.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/Estupro2013.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2016.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2015.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2014.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).defer(dsv,"./csv/ROcorrencias-2013.csv",function(e){return{aisp:+e.AISP,dp:+e.DP,meses:[+e.JAN,+e.FEV,+e.MAR,+e.ABR,+e.MAI,+e.JUN,+e.JUL,+e.AGO,+e.SET,+e.OUT,+e.NOV,+e.DEZ],total:+e.TOTAL}}).await(function(e,a,s,t,o,n,l,d,i){function r(e,a){var s;for(I=0;I<e.length;I++)for(isNaN(e[I].total)||(s=e[I].total/a,e[I].total=12*s),j=a;j<12;j++)e[I].meses[j]=s}e&&console.log(e);var c=[],p=[];r(a,4),r(n,4),c.push(a),c.push(s),c.push(t),c.push(o),p.push(n),p.push(l),p.push(d),p.push(i);var I,u={},g={},v=[],A={},S=[],P=0,D=0;for(j=0;j<c.length;j++)for(g[2016-j]=[],v.push({}),A[2016-j]=[0,0,0,0,0,0,0,0,0,0,0,0],I=0;I<c[j].length;I++)if(!isNaN(c[j][I].total)){for(g[2016-j].push([c[j][I].dp,c[j][I].total]),m=0;m<12;m++)isNaN(c[j][I].meses[m])||(A[2016-j][m]+=c[j][I].meses[m]);c[j][I].total>D&&(D=c[j][I].total),void 0==v[j][c[j][I].aisp]?v[j][c[j][I].aisp]=c[j][I].total:v[j][c[j][I].aisp]+=c[j][I].total}var f=[];for(j in A)for(m=0;m<12;m++)I=f.length,f.push([I,A[j][m]]);for(j=0;j<c.length;j++){S.push(0),u[2016-j]=[];for(var I in v[j])u[2016-j].push([+I,v[j][I]]),v[j][I]>P&&(P=v[j][I]),S[j]+=v[j][I]}vetDados.push({selecionado:!0,dados:g,distribuicao:"linear",tipo:"cisp",total:f,range:[0,D],legenda1:["Estupros por CISP","Rape cases by CISP"][lang],legenda2:["Estupros p/CISP","Rape cases/CISP"][lang],classes:6,ano:2013}),vetDados.push({selecionado:!0,dados:u,distribuicao:"linear",tipo:"aisp",total:f,range:[0,P],legenda1:["Estupros por AISP","Rape cases by AISP"][lang],legenda2:["Estupros p/AISP","Rape cases/AISP"][lang],classes:6,ano:2013}),vetDados.push({selecionado:!1,legenda1:"──────────────────────────────"});var h={},O={},T={};for(v=[],P=0,D=0,j=0;j<p.length;j++)for(O[2016-j]=[],T[2016-j]=[0,0,0,0,0,0,0,0,0,0,0,0],v.push({}),I=0;I<p[j].length;I++)if(!isNaN(p[j][I].total)){for(O[2016-j].push([p[j][I].dp,p[j][I].total]),m=0;m<12;m++)isNaN(p[j][I].meses[m])||(T[2016-j][m]+=p[j][I].meses[m]);p[j][I].total>D&&(D=p[j][I].total),void 0==v[j][p[j][I].aisp]?v[j][p[j][I].aisp]=p[j][I].total:v[j][p[j][I].aisp]+=p[j][I].total}var R=[];for(j in T)for(m=0;m<12;m++)I=R.length,R.push([I,T[j][m]]);for(S=[],j=0;j<p.length;j++){S.push(0),h[2016-j]=[];for(var I in v[j])h[2016-j].push([+I,v[j][I]]),v[j][I]>P&&(P=v[j][I]),S[j]+=v[j][I]}vetDados.push({selecionado:!0,dados:O,distribuicao:"linear",tipo:"cisp",total:R,range:[0,D],legenda1:["Registro de Ocorrências por CISP","Total cases by CISP"][lang],legenda2:["Registro de Ocorrências p/CISP","Total cases/CISP"][lang],classes:6,ano:2013}),vetDados.push({selecionado:!0,dados:h,distribuicao:"linear",tipo:"aisp",total:R,range:[0,P],legenda1:["Registro de Ocorrências por AISP","Total cases by AISP"][lang],legenda2:["Registro de Ocorrências p/AISP","Total cases/AISP"][lang],classes:6,ano:2013}),preencheIndicador(vetDados)});var TITULORIO;TITULORIO=["Casos de Estupro no Rio de Janeiro","Rio de Janeiro rape cases"][lang];var TODASAISPS,TODASRISPS,TODASCIRPS;TODASAISPS=["Áreas Integradas de Segurança Pública","Integrated Areas of Public Safety"][lang],TODASRISPS=["Regiões Integradas de Segurança Pública","Integrated Regions of Public Safety"][lang],TODASCIRPS=["Circunscrições Integradas de Segurança Pública","Integrated Circumscriptions of Public Safety"][lang];var hist=hs.histograma(),rio=cl.pintaMapa(),selInd,classesInput=d3.select("#classe").on("input",redraw).on("change",redraw),classes,espera=setInterval(inicializaMapa,500);